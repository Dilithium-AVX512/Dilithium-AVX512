#include <stdint.h>
#include "params.h"
#include "consts.h"

#define QINV 58728449 // q^(-1) mod 2^32
#define MONT -4186625 // 2^32 mod q
#define DIV 41978 // mont^2/256
#define DIV_QINV -8395782

const qdata_t qdata = {{
#define _16XQ 0
  Q, Q, Q, Q, Q, Q, Q, Q, Q, Q, Q, Q, Q, Q, Q, Q,

#define _16XQINV 16
  QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV,

#define _16XDIV_QINV 32
  DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV, DIV_QINV,

#define _16XDIV 48
  DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV,
// mask
#define _zmm21 64
  14,15,12,13,10,11,8,9,6,7,4,5,2,3,0,1,

/* 
   ZETAS_QINV=ZETAS*(QINV) mod 2^32  QINV=q^(-1) mod 2^32
   mask：61680 = 0b1111000011110000；43690 = 0b1010101010101010
*/
#define _ZETAS_QINV 80
// _ZETAS_QINV of level0 1830765815   
   -151046689,           0,           0,           0,           0,       43690,       61680,  1830765815, 
            0,           0,           0,           0,           0,           0,           0,           0,
// _ZETAS_QINV of level1 
  -1929875198, -1929875198, -1929875198, -1929875198, -1929875198, -1929875198, -1929875198, -1929875198,
  -1927777021, -1927777021, -1927777021, -1927777021, -1927777021, -1927777021, -1927777021, -1927777021,
// _ZETAS_QINV of level2
   1640767044,  1640767044,  1640767044,  1640767044,  1477910808,  1477910808,  1477910808,  1477910808,
   1612161320,  1612161320,  1612161320,  1612161320,  1640734244,  1640734244,  1640734244,  1640734244,
// _ZETAS_QINV of level3
    308362795,   308362795, -1815525077, -1815525077, -1374673747, -1374673747, -1091570561, -1091570561,
  -1929495947, -1929495947,   515185417,   515185417,  -285697463,  -285697463,   625853735,   625853735, 
// _ZETAS_QINV of level4
   1727305304,  2082316400, -1364982364,   858240904,  1806278032,   222489248,  -346752664,   684667771, 
   1654287830,  -878576921, -1257667337,  -748618600,   329347125,  1837364258, -1443016191, -1170414139,
// _ZETAS_QINV of level5
  -1846138265, -1404529459,  1594295555, -1898723372,  -202001019,  -561427818, -1061813248, -1661512036, 
  -1750224323,   418987550, -1925356481,   879957084,  1484874664,  -285388938, -1495136972, -1714807468,  
  -1631226336,  1838055109, -1076973524,  -594436433,  -475984260,  1797021249,  2059733581, -1104976547,
   -901666090,  1831915353,   992097815,  2024403852, -1636082790, -1983539117,  -950076368,  -952438995,
// _ZETAS_QINV of level6
  -1574918427, -2143979939, -1285853323, -1440787840,  -783134478,   289871779,  2135294594,  -889861155,  
   1321868265, -1784632064,   675310538, -1999506068,  -695180180,  1777179795,  -178766299,  1957047970,  
   -654783359,  1651689966, -1039411342,  1529189038,  -247357819,   -86965173,  1787797779,  -120646188, 
   -916321552,  2143745726, -1261461890,   628664287,  1422575624, -1185330464,   168022240,   985155484,  
   1350681039,  1599739335,  -993005454,   568627424,  -588790216, -1262003603, -1018755525,  1665705315,
   1225434135,   666258756, -1555941048, -1499481951, -1375177022,   334803717,  -518252220,  1146323031,
  -1974159335,   140455867,  1955560694, -2131021878,  1518161567,  1708872713,  1638590967, -1669960606,
   1155548552,  1210558298,  -318346816, -1729304568,  1424130038,   235321234,  1206536194,  -894060583,
// _ZETAS_QINV of level7
      -898413,  -605900043,    14253662,   863641633,  2124962073, -1920467227, -1536588520,   235104446, 
    831969619,   756955444,  1554794072, -2040058690, -2047270596, -1591599803,  1119856484,   155290192,  
    991903578,   -44694137,  -421552614,  1747917558,   908452108, -1176751719,   -72690498,   985022747,  
  -1078959975, -1021949428,   173440395, -1316619236,     6087993,   565464272, -1600929361, -1809756372,   
   1363007700,  -326425360,  -517299994, -1372618620, -1123881663,  -635454918,    45766801, -2070602178,  
   1216882040, -1276805128, -1357098057,   827959816,   702390549,  -260424530, -1208667171,  2036925262,  
    746144248,  2032221021,  1257750362,  1931587462,   885133339,  1967222129, -1287922800,  1779436847,  
   1042326957,   713994583, -1542497137,  -883155599, -1547952704,   283780712,  1123958025,  1934038751, 
  -1363460238,  2027833504,  1014493059,  1819892093, -1223601433, -1637785316,   694382729, -1045062172,
   -300448763,  -260312805,  1339088280,  -853476187, -1723816713,  -440824168,  1544891539,  -973777462,
    912367099,  1176904444,  -818371958,  -325927722,  1851023419, -1354528380,  -314284737,   963438279,
    604552167,   608791570, -2126092136, -1039370342,  -110126092, -1758099917,   879867909,   400711272,
     30313375,  1683520342,  2027935492,   128353682,   137583815,  -642772911,   671509323,   419615363,
   -270590488,   371462360,  -384158533,  -596344473,  -279505433,   -71875110, -1499603926,  -540420426,
  -1420958686,  1904936414,  1926727420,  1258381762,  1629985060,     6363718,  1136965286,  1116720494,
   1405999311,   940195359,  2061661095,  1726753853,   394851342,   776003547,   201262505,   374860238,


/*   ZETAS=centerlift(mont * r^(brv[i]))  mont=2^32 mod q     r^512=1 mod q && r^256=-1 mod q
     -3975713=(r^128)*(2^32)*(2^24) mod Q
*/
#define _ZETAS 384
// _ZETAS of level0 brv={128}
  -3975713,        0,        0,        0,        0,        0,        0,    25847, 
         0,        0,        0,        0,        0,        0,        0,        0,
// _ZETAS of level1 brv={64, 192}
  -2608894, -2608894, -2608894, -2608894, -2608894, -2608894, -2608894, -2608894, 
   -518909,  -518909,  -518909,  -518909,  -518909,  -518909,  -518909,  -518909,
// _ZETAS of level2 brv={32, 160, 96, 224}
    237124,   237124,   237124,   237124,  -777960,  -777960,  -777960,  -777960, 
   -876248,  -876248,  -876248,  -876248,   466468,   466468,   466468,   466468,
// _ZETAS of level3 brv={16, 144, 80, 208, 48, 176, 112, 240}
   1826347,  1826347,  2353451,  2353451,  -359251,  -359251, -2091905, -2091905,  
   3119733,  3119733, -2884855, -2884855,  3111497,  3111497,  2680103,  2680103,
// _ZETAS of level4 brv={8, 136, 72, 200, 40, 168, 104, 232, 24, 152, 88, 216, 56, 184, 120, 248}
   2725464,  1024112, -1079900,  3585928,  -549488, -1119584,  2619752, -2108549, 
  -2118186, -3859737, -1399561, -3277672,  1757237,   -19422,  4010497,   280005,
// _ZETAS of level5 brv={4, 68,  36,  100, 20,  84,  52,  116, 12,  76,  44,  108, 28,  92,  60, 124,
//                     132, 196, 164, 228, 148, 212, 180, 244, 140, 204, 172, 236, 156, 220, 188, 252}
   2706023,  3077325, -1661693, -2537516, -3861115,  3574422,  3539968,  2348700,  
  -1699267,  3505694,  3507263, -1600420,   811944,   954230,  3900724,  2071892, 
     95776,  3530437, -3592148,  3915439, -3043716, -2867647,  -300467,  -539299,
  -1643818, -3821735, -2140649,  3699596,   531354,  3881043, -2556880, -2797779,
// _ZETAS of level6 brv={2, 34, 18, 50, 10, 42, 26, 58, 6, 38, 22, 54, 14, 46, 30, 62, 
//                      130, 162, 146, 178, 138, 170, 154, 186, 134, 166,150, 182, 142, 174, 158, 190, 
//                       66, 98, 82,  114, 74, 106, 90, 122, 70, 102, 86, 118, 78, 110, 94, 126, 
//                      194, 226, 210, 242, 202, 234, 218, 250, 198, 230, 214, 246, 206, 238, 222, 254}
  -3930395, -1452451, -1257611, -3190144,  3412210, -2967645,  -671102,  -381987,  
  -3343383,    44288, -3724342,  2389356,   189548, -2409325,  1285669, -3019102, 
  -1528703,  3475950,  1939314, -3157330,  -983419, -3693493, -1228525,  1349076, 
    264944, -1100098,    -8578,  -210977, -3553272,  -177440, -1584928, -3881060,  
  -3677745,  2176455, -4083598, -3632928,  2147896,  -411027,   -22981,  1852771,
    508951,   904516,  1653064,   759969,  3159746,  1315589,  -812732, -3628969,
  -3041255, -1585221, -1000202,   126922,  2715295, -2477047, -1308169, -1430430,
   3097992,  3958618, -3249728, -1316856, -1851402,  1341330, -1439742,  3839961,
//  _ZETAS of level7  1, 17, 9, 25, 5, 21, 13, 29, 3, 19, 11, 27, 7, 23, 15, 31, 
//                   129, 145, 137, 153, 133, 149, 141, 157, 131, 147, 139, 155, 135, 151, 143, 159, 
//                    65, 81, 73, 89, 69, 85, 77, 93, 67, 83, 75, 91, 71, 87, 79, 95,  
//                   193, 209, 201, 217, 197, 213, 205,221, 195, 211, 203,219, 199, 215, 207, 223,
//                   33, 49, 41, 57, 37, 53, 45, 61,  35, 51, 43, 59, 39, 55, 47, 63,
//                   161, 177, 169, 185, 165, 181, 173, 189, 163, 179, 171, 187, 167, 183, 175, 191, 
//                   97, 113, 105, 121,  101, 117, 109, 125, 99, 115, 107, 123, 103, 119, 111, 127, 
//                   225, 241, 233, 249, 229, 245, 237, 253, 227, 243, 235, 251, 231, 247, 239, 255
   2091667,   266997,   900702,  -655327,   342297,  2842341, -3767016, -1333058,  
  -1279661,  -542412, -2013608, -3183426, -3038916,  -426683, -2939036,  -554416,  
   3407706,  2434439,  1859098, -3122442,   286988,  2691481,  1250494,  1237275, 
   1917081, -2831860,  2432395,   162844,  3523897,  1723600, -2235985,  3919660,  
   2316500, -1235728,   909542,  2031748, -2437823, -2590150,  2635921, -3318210,  
  -2546312, -1671176,  2454455,  1616392,  3866901, -1803090,  -420899,   -48306, 
   3817976,  3513181,   819034,  3207046,  4108315,  1265009, -3548272, -1430225, 
  -1374803, -1846953,  -164721,  3014001,   269760,  1910376, -2286327, -1362209,  
  -3342478, -3520352,   495491, -3556995,  3437287,  4055324, -2994039,  -451100,
   1500165, -2584293,  1957272,   810149,  2213111, -1667432,   183443,  3937738,
   2244091, -3759364, -1613174,  -525098, -3342277,  1247620,  1869119,  1312455,
    777191, -3724270,  3369112,  1652634,  -975884, -1104333,  -976891,  1400424,
  -2446433, -1197226,   -43260,  -768622,  1735879,  2486353,  1903435,  3306115,
   2235880,   594136,   185531, -3694233,  1717735,  -260646,  1612842,  -846154,
  -3562462, -3193378,  -522500, -3595838,   203044,  1595974, -1050970, -1962642,
   3406031, -3776993, -1207385, -1799107,   472078, -3833893, -3545687,  1976782,
}};
